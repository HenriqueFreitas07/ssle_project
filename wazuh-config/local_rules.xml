<group name="local,network_dos,apache_overload,syn_flood,">
  <!-- Existing rules from your configuration -->
  <rule id="200100" level="7">
    <if_sid>530</if_sid>
    <match>established connection</match>
    <description>New network connection observed</description>
  </rule>

  <rule id="200101" level="12" frequency="200" timeframe="30">
    <if_matched_sid>200100</if_matched_sid>
    <description>High rate of new TCP/UDP connections (Possible DoS)</description>
    <group>dos,network,</group>
  </rule>

  <rule id="200110" level="5">
    <match>network_traffic</match>
    <description>Network traffic event</description>
    <group>network</group>
  </rule>

  <rule id="200111" level="10">
    <if_sid>200110</if_sid>
    <regex>rx_bytes": ([0-9]{9,})</regex>
    <description>High inbound network throughput detected (Possible overload)</description>
    <group>dos,network</group>
  </rule>

  <rule id="200120" level="6">
    <if_sid>530</if_sid>
    <match>dstport:80</match>
    <description>New connection to Apache HTTP</description>
  </rule>

  <rule id="200121" level="6">
    <if_sid>530</if_sid>
    <match>dstport:443</match>
    <description>New connection to Apache HTTPS</description>
  </rule>

<rule id="200122" level="14" frequency="50" timeframe="20">
    <if_matched_sid>200120,200121</if_matched_sid>
    <description>High rate of inbound connections to Apache (Possible HTTP flood)</description>
    <group>dos,http_flood,apache,</group>
  </rule>

  <rule id="200130" level="8">
    <if_sid>550</if_sid>
    <match>SYN</match>
    <description>TCP SYN packet observed</description>
  </rule>

  <rule id="200131" level="15" frequency="300" timeframe="20">
    <if_matched_sid>200130</if_matched_sid>
    <description>Potential SYN flood detected</description>
    <group>dos,syn_flood,</group>
  </rule>

  
  <rule id="200140" level="10" frequency="50" timeframe="60">
    <if_matched_sid>200120,200121</if_matched_sid>
    <same_source_ip />
    <description>Same IP making repeated connections to Apache</description>
    <group>dos,apache,http_flood,</group>
  </rule>

  <rule id="200150" level="10">
    <if_sid>30301</if_sid>
    <match>error</match>
    <description>Apache error detected</description>
  </rule>

  <rule id="200151" level="13" frequency="10" timeframe="30">
    <if_matched_sid>200150</if_matched_sid>
    <description>High rate of Apache errors (Possible DoS impact)</description>
    <group>dos,apache,service_availability,</group>
  </rule>

  <rule id="200160" level="7">
    <if_sid>530</if_sid>
    <match>protocol: udp</match>
    <description>UDP connection observed</description>
  </rule>

  <rule id="200161" level="13" frequency="400" timeframe="30">
    <if_matched_sid>200160</if_matched_sid>
    <description>UDP flood detected</description>
    <group>dos,udp_flood,network,</group>
  </rule>

  <rule id="200170" level="12" frequency="100" timeframe="120">
    <if_matched_sid>200120,200121</if_matched_sid>
    <same_source_ip />
    <description>Potential slowloris attack (many slow connections from same IP)</description>
    <group>dos,slowloris,apache,</group>
  </rule>

  <!-- Detect when active response blocks an attacker -->
  <rule id="200180" level="5">
    <if_sid>651</if_sid>
    <match>firewall-drop</match>
    <description>Active response: IP blocked by firewall</description>
    <group>active_response,</group>
  </rule>

  <rule id="200181" level="3">
    <if_sid>652</if_sid>
    <match>firewall-drop</match>
    <description>Active response: IP unblocked by firewall</description>
    <group>active_response,</group>
  </rule>

</group>
